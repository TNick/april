<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>april: Example 5 - DNA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">april
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">...</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('e_1_5.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example 5 - <a class="el" href="classapril_1_1DNA.html" title="Represents persistent read-only storage space for Actors.">DNA</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="classapril_1_1DNA.html" title="Represents persistent read-only storage space for Actors.">DNA</a> represents storage space for information that is read-only from the point of view of actors - the entities that live in our worlds. We will see what are actors and how to use them later. For now, let's concentrate on <a class="el" href="classapril_1_1DNA.html" title="Represents persistent read-only storage space for Actors.">DNA</a>, as it is a central concept of the library.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dna_8h.html" title="Contains the definition for DNA class.">april/logic/dna.h</a>&gt;</span></div>
</div><!-- fragment --><p> <a class="el" href="classapril_1_1DNA.html" title="Represents persistent read-only storage space for Actors.">DNA</a> has storage space for two kinds of values: 64-bit unsigned integers and double-precision floating points.</p>
<p>The integer part is somehow restrictive and has a rigid structure. It stores informations about the <a class="el" href="classapril_1_1Actor.html" title="An active ocupier of the world.">Actor</a>, like its kind, the cost of running it, average age, amount of energy needed at birth, ... It also stores lists of IDs representing the component parts of an actor, grouped by categories (sensors, reflexes, brains, actuators).</p>
<p>The real part is more flexible. It is also subject to random variations and merging (creating a new <a class="el" href="classapril_1_1DNA.html" title="Represents persistent read-only storage space for Actors.">DNA</a> sequence from two parent sequences). The space of values is divided into parts, each assigned to an ID. These parts have variable lenght (they may grow) and are relocatable, so that the only reliable way of addressing the is through the ID.</p>
<p>The list of parts is not searchable - the caller must know the ID. If the ID is not found then the Fabric is employed in creating a new, default sequence that is appended, a new part is generated and returned to the caller.</p>
<p>To demonstrate the usage of <a class="el" href="classapril_1_1DNA.html" title="Represents persistent read-only storage space for Actors.">DNA</a> we will make use of a derived class to gain access to the initialisation method. This is not regular use, since this initialisation is performed by the <a class="el" href="classapril_1_1ActorFactory.html" title="Factory class for agents.">ActorFactory</a>. </p>
<div class="fragment"><div class="line"><span class="keyword">class </span>DNAProxy  : <span class="keyword">public</span> DNA    {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span>            initDNAProxy            ( <span class="keyword">const</span> InitData &amp; init )</div>
<div class="line">    {</div>
<div class="line">        initDNA( init );</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --> <div class="fragment"><div class="line">    DNAProxy dna;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Valid DNA instance: &quot;</span> &lt;&lt; dna.isValid() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><p>The initial instance is invalid. It needs to be initialised with the kind and other fixed values: </p>
<div class="fragment"><div class="line">    DNA::InitData initd;</div>
<div class="line">    initd.kind_ = IdKind;</div>
<div class="line">    initd.cost_ = 1;</div>
<div class="line">    initd.age_ = 100;</div>
<div class="line">    initd.energy_ = 10;</div>
<div class="line">    dna.initDNAProxy( initd );</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Valid DNA instance: &quot;</span> &lt;&lt; dna.isValid() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - kind ID: &quot;</span> &lt;&lt; dna.kind() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - cost: &quot;</span> &lt;&lt; dna.cost() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - age: &quot;</span> &lt;&lt; dna.age() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - energy: &quot;</span> &lt;&lt; dna.energy() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><p> The initialisation creates empty lists for the components. An <a class="el" href="classapril_1_1Actor.html" title="An active ocupier of the world.">Actor</a> that would be created from this <a class="el" href="classapril_1_1DNA.html" title="Represents persistent read-only storage space for Actors.">DNA</a> would be an empty one. </p>
<div class="fragment"><div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - number of sensors: &quot;</span> &lt;&lt; dna.sensors().count() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - number of reflexes: &quot;</span> &lt;&lt; dna.reflexes().count() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - number of brains: &quot;</span> &lt;&lt; dna.brains().count() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - number of actuators: &quot;</span> &lt;&lt; dna.actuators().count() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><p> Adding components to the structure is done in straight-forward fashion: </p>
<div class="fragment"><div class="line">    dna.addBrain( IdBrain );</div>
<div class="line">    dna.addActuator( IdActuator );</div>
<div class="line">    dna.addSensor( IdSensor );</div>
<div class="line">    dna.addReflex( IdReflex );</div>
<div class="line">    </div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;DNA instance after component insertion: \n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - number of sensors: &quot;</span> &lt;&lt; dna.sensors().count() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - number of reflexes: &quot;</span> &lt;&lt; dna.reflexes().count() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - number of brains: &quot;</span> &lt;&lt; dna.brains().count() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  - number of actuators: &quot;</span> &lt;&lt; dna.actuators().count() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><p> Now for the real, variable part, we also need to relly on a proxy <a class="el" href="classapril_1_1Factory.html" title="Base class for factory classes.">Factory</a> class: </p>
<div class="fragment"><div class="line"><span class="keyword">class </span>FactoryProxy : <span class="keyword">public</span> Factory {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    FactoryProxy( World * w ) : Factory( w )</div>
<div class="line">    { }</div>
<div class="line">    <span class="keyword">virtual</span> QList&lt;qreal&gt;        averageDNA      ( ID <span class="keywordtype">id</span> )<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{ </div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Default data requested for id &quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        QList&lt;qreal&gt;    ql;</div>
<div class="line">        ql &lt;&lt; 1.5 &lt;&lt; 1.6 &lt;&lt; 1.7;</div>
<div class="line">        <span class="keywordflow">return</span> ql;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><p> This is because when requested for an ID that it can not find, the <a class="el" href="classapril_1_1DNA.html" title="Represents persistent read-only storage space for Actors.">DNA</a> will use default values from the <a class="el" href="classapril_1_1Factory.html" title="Base class for factory classes.">Factory</a>. </p>
<div class="fragment"><div class="line">    FactoryProxy * fact = <span class="keyword">new</span> FactoryProxy( w );</div>
<div class="line">    DNAView v = dna.getView( IdBrain, fact );</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;DNA sequence for the brain ID &quot;</span> &lt;&lt; v.identificator() &lt;&lt; <span class="stringliteral">&quot;:\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; v.value( 0 );</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; v.value( 1 );</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; v.value( 2 );</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    </div>
<div class="line">    DEC_REF(fact,fact);</div>
</div><!-- fragment --><p> <br/>
<br/>
<hr/>
 <table  width="100%">
<tr>
<td align="left"><a class="el" href="e_1_4.html">Example 4 - IDs</a>  </td><td align="center"><a class="el" href="april-core.html">april-core library</a>  </td><td align="right"><a class="el" href="e_1_6.html">Example 6 - Factories</a>  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Apr 13 2013 22:26:57 for april by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
