<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>april: Example 2 - Creating a world</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">april
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">...</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('e_1_2.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example 2 - Creating a world </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>To actually use the library various headers need to be included. For this example we use: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="aprillibrary_8h.html" title="Contains the definition for AprilLibrary class.">april/aprillibrary.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="world_8h.html" title="Contains the definition for World class.">april/logic/world.h</a>&gt;</span></div>
</div><!-- fragment --><p> <a class="el" href="aprillibrary_8h.html" title="Contains the definition for AprilLibrary class.">aprillibrary.h</a> defines our library class and the initialisation functions. Also, since we've decided to create a world in this example we also include <a class="el" href="world_8h.html" title="Contains the definition for World class.">world.h</a> for the definition of <a class="el" href="classapril_1_1World.html" title="A world hosts agents, events, environment.">World</a> class.</p>
<p>All the definitions in the library are wrapped in following namespace: </p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>april;</div>
</div><!-- fragment --><p> As a final preparation we also define a constant: </p>
<div class="fragment"><div class="line"><span class="keyword">enum</span>    Constants       {</div>
<div class="line">    WORLD_ENERGY = 10000</div>
<div class="line">};</div>
</div><!-- fragment --><p>to be the total ammount of energy in our world.</p>
<p><a class="el" href="aprillibrary_8cc.html#aa81a7834126e5fbc22c7da8cf8dfe8b3" title="starts the library">initAprilLibrary()</a> needs to be called before making use of the library and will be latter matched by a <a class="el" href="aprillibrary_8cc.html#af78916bae194b07bb2f8f6e31fb24b4f" title="terminates the libraryl releases resources">endAprilLibrary()</a>. </p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span> ( <a class="code" href="aprillibrary_8cc.html#aa81a7834126e5fbc22c7da8cf8dfe8b3" title="starts the library">initAprilLibrary</a>() == <span class="keyword">false</span> )</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;Error! Failed to initialise april library!\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>It makes sure to load additional components that the library uses and creates the library singleton that will track resources. The library will fail to work without this initial step.</p>
<p>We are now ready to create our first world: </p>
<div class="fragment"><div class="line">    World * w = <span class="keyword">new</span> World( <span class="stringliteral">&quot;world-name&quot;</span>, WORLD_ENERGY );</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;World has been created!\n&quot;</span>;</div>
</div><!-- fragment --><p>We're required to provide a name and the total amount of energy that this world has. The name is used when saving settings and to identify the world in the messages that the library generates. The energy will be a hard limit for all actions that take place in the world. Creating things and performing actions will be limited by this factor.</p>
<p>Now that we have a world let's do something with it: </p>
<div class="fragment"><div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Total ammount of energy in the world: &quot;</span> &lt;&lt; w-&gt;energy() &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Unbounded energy in the world: &quot;</span> &lt;&lt; w-&gt;energyFree() &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Bounded (\&quot;used\&quot;) energy: &quot;</span> &lt;&lt; w-&gt;energyBounded() &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><p> Most of the objects in april library are reference-counted using the implementation in <a href="http://sourceforge.net/projects/libbbb/">libbbb</a>. The macros simply increment/decrement a counter in release builds, while in debug builds they maintain a list of references with the file, line, function name and pointer address all stored. The constructor creates a reference that is transmitted to the caller, so we have a reference for the <a class="el" href="classapril_1_1World.html" title="A world hosts agents, events, environment.">World</a> object. </p>
<div class="fragment"><div class="line">    DEC_REF(w,w);</div>
</div><!-- fragment --><p>However, the library also owns a reference to the object, so previous opperation will not cause the library to be destroyed. To achieve that goal we may use </p>
<div class="fragment"><div class="line">    <a class="code" href="classapril_1_1AprilLibrary.html#a6750ffad787608ce1597d13e5c15688c" title="remove a world">AprilLibrary::remWorld</a>( w );</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;World has been destroyed!\n&quot;</span>;</div>
</div><!-- fragment --><p>or we can let <a class="el" href="aprillibrary_8cc.html#af78916bae194b07bb2f8f6e31fb24b4f" title="terminates the libraryl releases resources">endAprilLibrary()</a> take care of this.</p>
<p>The last step is optional - terminate the library. However, it is recomended, mostly in debug builds when the memory tracking is in effect and may spot memory leaks: </p>
<div class="fragment"><div class="line">    <a class="code" href="aprillibrary_8cc.html#af78916bae194b07bb2f8f6e31fb24b4f" title="terminates the libraryl releases resources">endAprilLibrary</a>();</div>
</div><!-- fragment --><p> <br/>
<br/>
<hr/>
 <table  width="100%">
<tr>
<td align="left"><a class="el" href="e_1_1.html">Example 1 - Hello world</a>  </td><td align="center"><a class="el" href="april-core.html">april-core library</a>  </td><td align="right"><a class="el" href="e_1_3.html">Example 3 - Running a world</a>  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Apr 13 2013 22:26:57 for april by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
