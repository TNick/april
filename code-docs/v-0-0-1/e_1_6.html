<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>april: Example 6 - Factories</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">april
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">...</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('e_1_6.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example 6 - Factories </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The ID based components require classes to create the actual instances. These are the <a class="el" href="classapril_1_1Factory.html">Factory</a> factories.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="factory_8h.html" title="Contains the definition for Factory class.">april/logic/factory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sensorfactory_8h.html" title="Contains the definition for SensorFactory class.">april/logic/sensorfactory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="eventfactory_8h.html" title="Contains the definition for EventFactory class.">april/logic/eventfactory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="actuatorfactory_8h.html" title="Contains the definition for ActuatorFactory class.">april/logic/actuatorfactory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="actorfactory_8h.html" title="Contains the definition for ActorFactory class.">april/logic/actorfactory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="brainfactory_8h.html" title="Contains the definition for BrainFactory class.">april/logic/brainfactory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="reflexfactory_8h.html" title="Contains the definition for ReflexFactory class.">april/logic/reflexfactory.h</a>&gt;</span></div>
</div><!-- fragment --><p> The library provides base classes for all required kinds of factories. The user often needs to specialise these base classes for its particular needs. Below a specialisation is presented for each factory class. Notice that the content for each class is similar:</p>
<ul>
<li>we have a constructor that requires a <a class="el" href="classapril_1_1World.html" title="A world hosts agents, events, environment.">World</a> instance; that is because the factory gets inserted in the world right from the constructor via addMyself() methods. The constructor also registers the ID that it uses (there may be multiple IDs, not just one as in these examples).</li>
<li>a create() method also needs to be implemented. This is the principal method - the reason for the <a class="el" href="classapril_1_1Factory.html" title="Base class for factory classes.">Factory</a> class. The method recieves an ID as argument because each factory may be used to create any number of different objects that inherit the target type.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>FActor : <span class="keyword">public</span> ActorFactory {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    FActor( World * w ) : ActorFactory( w ) {</div>
<div class="line">        w-&gt;insertId( IdKind, <span class="stringliteral">&quot;kinds.test&quot;</span> );</div>
<div class="line">        addMyself( IdKind );</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">virtual</span> Actor * create ( ID ) {</div>
<div class="line">        Actor * ret = <span class="keyword">new</span> Actor( world() ); </div>
<div class="line">        setDNA( ret );</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> copyDefaultDNA ( DNA &amp; destination ) { </div>
<div class="line">        destination = defaultDNA();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">};</div>
<div class="line"><span class="keyword">class </span>FSensor : <span class="keyword">public</span> SensorFactory {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    FSensor( World * w ): SensorFactory( w ) {</div>
<div class="line">        w-&gt;insertId( IdSensor, <span class="stringliteral">&quot;sensors.test&quot;</span> );</div>
<div class="line">        addMyself( IdSensor );</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">virtual</span> Sensor * create ( Actor * a, ID ) {</div>
<div class="line">        Sensor * ret = <span class="keyword">new</span> Sensor( a );</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">class </span>FEvent : <span class="keyword">public</span> EventFactory {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    FEvent( World * w ): EventFactory( w ) {</div>
<div class="line">        w-&gt;insertId( IdEvent, <span class="stringliteral">&quot;events.test&quot;</span> );</div>
<div class="line">        addMyself( IdEvent );</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">virtual</span> EventSource * create ( ID ) {</div>
<div class="line">        Ev * ret = <span class="keyword">new</span> Ev( world() );</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">class </span>FActuator : <span class="keyword">public</span> ActuatorFactory {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    FActuator( World * w ): ActuatorFactory( w ) {</div>
<div class="line">        w-&gt;insertId( IdActuator, <span class="stringliteral">&quot;actuators.test&quot;</span> );</div>
<div class="line">        addMyself( IdActuator );</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">virtual</span> Actuator * create ( Actor * a, ID ) {</div>
<div class="line">        Actuator * ret = <span class="keyword">new</span> Actuator( a );</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">class </span>FBrain : <span class="keyword">public</span> BrainFactory {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    FBrain( World * w ): BrainFactory( w ) {</div>
<div class="line">        w-&gt;insertId( IdBrain, <span class="stringliteral">&quot;brains.test&quot;</span> );</div>
<div class="line">        addMyself( IdBrain );</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">virtual</span> Brain * create ( Actor * a, ID ) {</div>
<div class="line">        Brain * ret = <span class="keyword">new</span> Brain( a );</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">class </span>FReflex : <span class="keyword">public</span> ReflexFactory {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    FReflex( World * w ): ReflexFactory( w ) {</div>
<div class="line">        w-&gt;insertId( IdReflex, <span class="stringliteral">&quot;reflexes.test&quot;</span> );</div>
<div class="line">        addMyself( IdReflex );</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">virtual</span> Reflex * create ( Actor * a, ID ) {</div>
<div class="line">        Reflex * ret = <span class="keyword">new</span> Reflex( a );</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><p> Not shown in previous example is that each factory has a averageDNA() method that the factory may use to initialise chunks of <a class="el" href="classapril_1_1DNA.html" title="Represents persistent read-only storage space for Actors.">DNA</a> for their respective types.</p>
<p>Once the world is created we create and insert an instance of each of these factories. </p>
<div class="fragment"><div class="line">    FActor * f_actor = <span class="keyword">new</span> FActor( w );</div>
<div class="line">    DEC_REF(f_actor,f_actor);</div>
<div class="line">    FSensor * f_sensor = <span class="keyword">new</span> FSensor( w );</div>
<div class="line">    DEC_REF(f_sensor,f_sensor);</div>
<div class="line">    FEvent * f_event = <span class="keyword">new</span> FEvent( w );</div>
<div class="line">    DEC_REF(f_event,f_event);</div>
<div class="line">    FActuator * f_actuator = <span class="keyword">new</span> FActuator( w );</div>
<div class="line">    DEC_REF(f_actuator,f_actuator);</div>
<div class="line">    FBrain * f_brain = <span class="keyword">new</span> FBrain( w );</div>
<div class="line">    DEC_REF(f_brain,f_brain);</div>
<div class="line">    FReflex * f_reflex = <span class="keyword">new</span> FReflex( w );</div>
<div class="line">    DEC_REF(f_reflex,f_reflex);</div>
</div><!-- fragment --><p>The world takes a reference for each factory so we can get rid of the constructor reference. When the world gets destructed these references are also released, causing the factories to be destroyed.</p>
<p><br/>
<br/>
<hr/>
 <table  width="100%">
<tr>
<td align="left"><a class="el" href="e_1_5.html">Example 5 - DNA</a>  </td><td align="center"><a class="el" href="april-core.html">april-core library</a>  </td><td align="right"><a class="el" href="e_1_7.html">Example 7 - Creating an actor</a>  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Apr 13 2013 22:26:57 for april by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
